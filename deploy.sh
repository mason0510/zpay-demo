#!/bin/bash

# Payment Gateway éƒ¨ç½²è„šæœ¬
set -e

echo "ğŸš€ å¼€å§‹éƒ¨ç½²æ”¯ä»˜ç½‘å…³..."

# æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¦ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull origin main

# åœæ­¢ç°æœ‰æœåŠ¡
echo "â¹ï¸  åœæ­¢ç°æœ‰æœåŠ¡..."
docker-compose down --remove-orphans

# æ„å»ºæ–°é•œåƒ
echo "ğŸ”¨ æ„å»ºæ–°é•œåƒ..."
docker-compose build --no-cache

# å¯åŠ¨æœåŠ¡
echo "â–¶ï¸  å¯åŠ¨æœåŠ¡..."
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 10

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "ğŸ” æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
if docker-compose ps | grep -q "Up"; then
    echo "âœ… æ”¯ä»˜ç½‘å…³éƒ¨ç½²æˆåŠŸï¼"
    echo "ğŸŒ è®¿é—®åœ°å€: https://pay.satoshitech.xyz/"
else
    echo "âŒ éƒ¨ç½²å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—:"
    docker-compose logs --tail=50
    exit 1
fi

echo "ğŸ“Š æœåŠ¡çŠ¶æ€ï¼š"
docker-compose ps